import{a as It}from"./chunk-ONP5GMX3.js";import{C as wt,F as _t,H as St,I as xt,K as Et,w as Ct}from"./chunk-PDR5UM57.js";import{B as E,b as lt,f as ct,g as ut,j as dt,l as ft,m as ht,n as gt,t as b,u as bt,v as yt}from"./chunk-ERJNKWX5.js";import{$ as _,Ab as ot,Bb as M,D,Ib as N,Ja as m,Kb as rt,Lb as nt,Na as u,Sa as h,Ta as Y,Wa as w,X as k,Zb as at,_a as p,aa as W,ba as z,bc as F,ca as l,dc as st,fb as a,gb as s,gc as mt,hb as f,hc as pt,ib as S,jb as x,k as B,ka as Q,la as q,lb as Z,ma as K,nb as g,ob as v,q as A,qc as O,r as T,rc as vt,t as V,ta as X,tb as tt,ub as et,v as U,vb as it,x as $,zb as d}from"./chunk-V72LI5IB.js";var Ut=()=>["../join"],Mt=()=>["../login"];function Nt(e,o){if(e&1&&(a(0,"p",14),d(1),s()),e&2){let t=v();m(),ot(t.error)}}function Jt(e,o){e&1&&(a(0,"p")(1,"mat-form-field",5),f(2,"input",15),s()())}function Lt(e,o){e&1&&(a(0,"p")(1,"mat-form-field",5),f(2,"input",16),s()())}function Pt(e,o){e&1&&f(0,"input",20)}function Gt(e,o){if(e&1&&f(0,"input",21),e&2){let t=v(2);p("ngModel",t.email)}}function Ht(e,o){if(e&1&&(a(0,"p")(1,"mat-form-field",17),w(2,Pt,1,0,"input",18)(3,Gt,1,1,"input",19),s()()),e&2){let t=v();m(2),p("ngIf",t.title=="Join"),m(),p("ngIf",t.title=="Update")}}function Bt(e,o){if(e&1&&(a(0,"p")(1,"mat-form-field",17),f(2,"input",22),s()()),e&2){let t=v();m(2),p("ngModel",t.city)}}function Vt(e,o){if(e&1&&(a(0,"p")(1,"mat-form-field",17),f(2,"input",23),s()()),e&2){let t=v();m(2),p("ngModel",t.about)}}function $t(e,o){e&1&&(S(0),a(1,"p"),d(2,"First time?"),s(),a(3,"button",24),d(4,"\u269C Create account \u269C"),s(),x()),e&2&&(m(3),p("routerLink",N(1,Ut)))}function Wt(e,o){e&1&&(S(0),a(1,"p"),d(2,"Already have an account?"),s(),a(3,"button",24),d(4,"\u269C Sign In \u269C"),s(),x()),e&2&&(m(3),p("routerLink",N(1,Mt)))}var y=class e{constructor(o){this.fb=o;this.error="";this.title="Login";this.userDetails=null;this.submitEmitter=new X;this.form=this.fb.group({username:[""],password:[""],email:[""],city:[""],about:[""]})}ngOnInit(){}ngOnChanges(){this.checkAction();try{this.email=this.userDetails.email,this.city=this.userDetails.city,this.about=this.userDetails.about}catch{}}checkAction(){this.userDetails&&this.patchDataValues()}patchDataValues(){this.userDetails&&this.form.patchValue(this.userDetails)}emitAction(){this.title==="Login"?this.submitEmitter.emit({username:this.form.value.username,password:this.form.value.password}):this.title==="Join"?this.submitEmitter.emit(this.form.value):this.title==="Update"&&this.submitEmitter.emit({email:this.form.value.email,city:this.form.value.city,about:this.form.value.about})}clear(){this.form.reset()}static{this.\u0275fac=function(t){return new(t||e)(u(gt))}}static{this.\u0275cmp=h({type:e,selectors:[["app-auth-form"]],inputs:{error:"error",title:"title",userDetails:"userDetails"},outputs:{submitEmitter:"submitEmitter"},standalone:!1,features:[Q],decls:23,vars:11,consts:[[1,"container","py-4"],[1,"row","justify-content-center"],[1,"col-12"],[1,"d-flex","flex-column","flex-md-row","justify-content-between","align-items-start","gap-4"],[1,"flex-fill"],[1,"w-100"],[1,"text-center"],[1,"content"],[3,"ngSubmit","formGroup"],["class","error",4,"ngIf"],[4,"ngIf"],[1,"d-grid","mt-3"],["type","submit","mat-raised-button","","color","primary"],[1,"text-center1","w-100","w-md-auto","d-flex","flex-column","align-items-center","gap-2"],[1,"error"],["type","text","matInput","","placeholder","Username","formControlName","username"],["type","password","matInput","","placeholder","Password","formControlName","password"],["appearance","fill",1,"w-100"],["type","text","matInput","","placeholder","Email","formControlName","email",4,"ngIf"],["type","text","matInput","","formControlName","email","autocomplete","off",3,"ngModel",4,"ngIf"],["type","text","matInput","","placeholder","Email","formControlName","email"],["type","text","matInput","","formControlName","email","autocomplete","off",3,"ngModel"],["type","text","matInput","","formControlName","city","autocomplete","off",3,"ngModel"],["type","text","matInput","","formControlName","about","autocomplete","off",3,"ngModel"],["mat-button","",3,"routerLink"]],template:function(t,i){t&1&&(a(0,"body")(1,"div",0)(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"mat-card",5)(7,"mat-card-title",6),d(8),s(),a(9,"mat-card-content",7)(10,"form",8),g("ngSubmit",function(){return i.emitAction()}),w(11,Nt,2,1,"p",9)(12,Jt,3,0,"p",10)(13,Lt,3,0,"p",10)(14,Ht,4,2,"p",10)(15,Bt,3,1,"p",10)(16,Vt,3,1,"p",10),a(17,"div",11)(18,"button",12),d(19),s()()()()()(),a(20,"div",13),w(21,$t,5,2,"ng-container",10)(22,Wt,5,2,"ng-container",10),s()()()()()()),t&2&&(m(8),M("\u26E7",i.title,"\u26E7"),m(2),p("formGroup",i.form),m(),p("ngIf",i.error),m(),p("ngIf",i.title=="Join"||i.title=="Login"),m(),p("ngIf",i.title=="Join"||i.title=="Login"),m(),p("ngIf",i.title=="Join"||i.title=="Update"),m(),p("ngIf",i.title=="Update"),m(),p("ngIf",i.title=="Update"),m(3),M("\u22C6",i.title,"\u22C6"),m(2),p("ngIf",i.title==="Login"),m(),p("ngIf",i.title==="Join"))},dependencies:[F,vt,dt,lt,ct,ut,ft,ht,Ct,wt,_t,St,Et,xt],styles:["body[_ngcontent-%COMP%]{min-height:100vh;width:100%;background-image:url(/assets/png/guard.png);background-blend-mode:overlay;background-size:38vw 35vw;background-repeat:no-repeat;background-attachment:fixed;background-position:center;background-position-y:85%}.mat-form-field[_ngcontent-%COMP%]{width:100%;min-width:300px}mat-card-title[_ngcontent-%COMP%], mat-card-content[_ngcontent-%COMP%]{display:flex;justify-content:center}.text-center[_ngcontent-%COMP%]{font-family:cardinal;font-size:5vw}.text-center1[_ngcontent-%COMP%]{font-family:cardinal;font-size:3.5vw}.content[_ngcontent-%COMP%]{font-family:charming;font-size:2.3vw;min-width:500px;max-width:800px;width:100%}"]})}};var Tt=class e{constructor(o){this.store=o}submitForm(o){this.store.dispatch({type:"[AUTH] Create User",payload:o})}static{this.\u0275fac=function(t){return new(t||e)(u(b))}}static{this.\u0275cmp=h({type:e,selectors:[["app-join"]],standalone:!1,decls:1,vars:0,consts:[["title","Join",3,"submitEmitter"]],template:function(t,i){t&1&&(a(0,"app-auth-form",0),g("submitEmitter",function(n){return i.submitForm(n)}),s())},dependencies:[y],encapsulation:2})}};var H=new z("JWT_OPTIONS"),j=(()=>{class e{constructor(t=null){this.tokenGetter=t&&t.tokenGetter||function(){}}urlBase64Decode(t){let i=t.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:{i+="==";break}case 3:{i+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(i)}b64decode(t){let i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="";if(t=String(t).replace(/=+$/,""),t.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let n=0,C,c,jt=0;c=t.charAt(jt++);~c&&(C=n%4?C*64+c:c,n++%4)?r+=String.fromCharCode(255&C>>(-2*n&6)):0)c=i.indexOf(c);return r}b64DecodeUnicode(t){return decodeURIComponent(Array.prototype.map.call(this.b64decode(t),i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(t=this.tokenGetter()){return t instanceof Promise?t.then(i=>this._decodeToken(i)):this._decodeToken(t)}_decodeToken(t){if(!t||t==="")return null;let i=t.split(".");if(i.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let r=this.urlBase64Decode(i[1]);if(!r)throw new Error("Cannot decode the token.");return JSON.parse(r)}getTokenExpirationDate(t=this.tokenGetter()){return t instanceof Promise?t.then(i=>this._getTokenExpirationDate(i)):this._getTokenExpirationDate(t)}_getTokenExpirationDate(t){let i;if(i=this.decodeToken(t),!i||!i.hasOwnProperty("exp"))return null;let r=new Date(0);return r.setUTCSeconds(i.exp),r}isTokenExpired(t=this.tokenGetter(),i){return t instanceof Promise?t.then(r=>this._isTokenExpired(r,i)):this._isTokenExpired(t,i)}_isTokenExpired(t,i){if(!t||t==="")return!0;let r=this.getTokenExpirationDate(t);return i=i||0,r===null?!1:!(r.valueOf()>new Date().valueOf()+i*1e3)}getAuthScheme(t,i){return typeof t=="function"?t(i):t}}return e.\u0275fac=function(t){return new(t||e)(l(H))},e.\u0275prov=_({token:e,factory:e.\u0275fac}),e})(),Dt=e=>e instanceof Promise?$(()=>e):A(e),zt=(()=>{class e{constructor(t,i,r){this.jwtHelper=i,this.document=r,this.standardPorts=["80","443"],this.tokenGetter=t.tokenGetter,this.headerName=t.headerName||"Authorization",this.authScheme=t.authScheme||t.authScheme===""?t.authScheme:"Bearer ",this.allowedDomains=t.allowedDomains||[],this.disallowedRoutes=t.disallowedRoutes||[],this.throwNoTokenError=t.throwNoTokenError||!1,this.skipWhenExpired=t.skipWhenExpired}isAllowedDomain(t){let i=new URL(t.url,this.document.location.origin);if(i.host===this.document.location.host)return!0;let r=`${i.hostname}${i.port&&!this.standardPorts.includes(i.port)?":"+i.port:""}`;return this.allowedDomains.findIndex(n=>typeof n=="string"?n===r:n instanceof RegExp?n.test(r):!1)>-1}isDisallowedRoute(t){let i=new URL(t.url,this.document.location.origin);return this.disallowedRoutes.findIndex(r=>{if(typeof r=="string"){let n=new URL(r,this.document.location.origin);return n.hostname===i.hostname&&n.pathname===i.pathname}return r instanceof RegExp?r.test(t.url):!1})>-1}handleInterception(t,i,r){let n=this.jwtHelper.getAuthScheme(this.authScheme,i);if(!t&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");let C=A(!1);return this.skipWhenExpired&&(C=t?Dt(this.jwtHelper.isTokenExpired(t)):A(!0)),t?C.pipe(V(c=>c&&this.skipWhenExpired?i.clone():i.clone({setHeaders:{[this.headerName]:`${n}${t}`}})),U(c=>r.handle(c))):r.handle(i)}intercept(t,i){if(!this.isAllowedDomain(t)||this.isDisallowedRoute(t))return i.handle(t);let r=this.tokenGetter(t);return Dt(r).pipe(U(n=>this.handleInterception(n,t,i)))}}return e.\u0275fac=function(t){return new(t||e)(l(H),l(j),l(at))},e.\u0275prov=_({token:e,factory:e.\u0275fac}),e})(),Se=(()=>{class e{constructor(t){if(t)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(t){return{ngModule:e,providers:[{provide:pt,useClass:zt,multi:!0},t.jwtOptionsProvider||{provide:H,useValue:t.config},j]}}}return e.\u0275fac=function(t){return new(t||e)(l(e,12))},e.\u0275mod=Y({type:e}),e.\u0275inj=W({}),e})();var R=class e{constructor(o,t,i,r,n){this.http=o;this.jwtHelper=t;this.dataService=i;this.router=r;this.store=n;this.userSubject=new B(null);this.user$=this.userSubject.asObservable();this.isLogged=!1}ngOnInit(){this.dataService.currentState.subscribe(o=>this.isLogged=o)}join(o){return this.http.post(`${E.baseURL}/join`,o).pipe(D(t=>(console.error("Registration error:",t),T(()=>new Error(t.error?.message||"Registration failed. Please try again.")))))}login(o){return this.dataService.log(!0),this.http.post(`${E.baseURL}/login`,o).pipe(k(t=>{t.token&&localStorage.setItem("jwtToken",t.token)}),D(t=>(console.error("Login error:",t),T(()=>new Error(t.error?.message||"Login failed. Please try again.")))))}getUser(){return this.http.get(`${E.baseURL}/home/settings`).pipe(k(o=>o),D(o=>T(()=>o)))}update(o){return this.http.put(`${E.homeURL}/settings`,o).pipe(k(t=>t))}isAuthenticated(){let o=this.getToken();return o?!this.jwtHelper.isTokenExpired(o):!1}getToken(){return localStorage.getItem("jwtToken")}logout(){localStorage.removeItem("jwtToken"),localStorage.removeItem("details"),this.userSubject.next(null),this.dataService.log(!1),this.store.dispatch({type:"[AUTH] Logout"}),this.router.navigate(["/login"])}static{this.\u0275fac=function(t){return new(t||e)(l(mt),l(j),l(It),l(O),l(b))}}static{this.\u0275prov=_({token:e,factory:e.\u0275fac,providedIn:"root"})}};var kt=class e{constructor(o,t,i){this.store=o;this.service=t;this.router=i;this.checkJWT()}ngOnInit(){}submitForm(o){this.store.dispatch({type:"[AUTH] Login",payload:o})}checkJWT(){this.service.isAuthenticated()&&this.router.navigate(["home"])}static{this.\u0275fac=function(t){return new(t||e)(u(b),u(R),u(O))}}static{this.\u0275cmp=h({type:e,selectors:[["app-login"]],standalone:!1,decls:1,vars:0,consts:[["title","Login",3,"submitEmitter"]],template:function(t,i){t&1&&(a(0,"app-auth-form",0),g("submitEmitter",function(n){return i.submitForm(n)}),s())},dependencies:[y],encapsulation:2})}};var Kt=yt("authState");var Ft=()=>bt(Kt,e=>e.user);var Xt=["successToast"];function Yt(e,o){if(e&1){let t=Z();S(0),a(1,"app-auth-form",7),g("submitEmitter",function(r){q(t);let n=v();return K(n.submitForm(r))}),s(),x()}if(e&2){let t=o.ngIf;m(),p("userDetails",t)}}var Ot=class e{constructor(o){this.store=o;this.userDetails=null;this.user$=this.store.select(Ft())}ngOnInit(){this.store.dispatch({type:"[AUTH] Get User"})}submitForm(o){this.store.dispatch({type:"[AUTH] Update",payload:o}),new bootstrap.Toast(this.successToast.nativeElement).show()}static{this.\u0275fac=function(t){return new(t||e)(u(b))}}static{this.\u0275cmp=h({type:e,selectors:[["app-update"]],viewQuery:function(t,i){if(t&1&&tt(Xt,5),t&2){let r;et(r=it())&&(i.successToast=r.first)}},standalone:!1,decls:9,vars:3,consts:[["successToast",""],[4,"ngIf"],[1,"toast-container","position-fixed","top-50","start-50","translate-middle"],["aria-live","assertive","aria-atomic","true",1,"toast","custom-toast","align-items-center"],[1,"d-flex"],[1,"toast-body"],["type","button","data-bs-dismiss","toast","aria-label","Close",1,"btn-close","btn-close-black","me-2","m-auto"],["title","Update",3,"submitEmitter","userDetails"]],template:function(t,i){t&1&&(w(0,Yt,2,1,"ng-container",1),rt(1,"async"),a(2,"div",2)(3,"div",3,0)(5,"div",4)(6,"div",5),d(7," \u{1D11E} - \u266B\u22C6\uFF61\u266A \u208A\u02DA\u266C\uFF9F. data updated successfully ! \u266A \u208A\u02DA "),s(),f(8,"button",6),s()()()),t&2&&p("ngIf",nt(1,1,i.user$))},dependencies:[F,y,st],styles:[".custom-toast[_ngcontent-%COMP%]{width:100%;text-align:center;border-color:#3b3b04;font-family:cardinal;padding:.8vw 2vw;box-shadow:0 8px 16px #dbcca3;font-size:2.5vw;border-radius:25%;color:#000;background-color:#d0cab8;opacity:.7}"]})}};export{Tt as a,Se as b,R as c,kt as d,Ot as e};
