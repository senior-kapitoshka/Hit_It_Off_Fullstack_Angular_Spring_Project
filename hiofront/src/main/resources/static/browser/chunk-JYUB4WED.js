import{a as it}from"./chunk-NAJAWU72.js";import{a as O,b as rt,c as w}from"./chunk-PLDY3HMN.js";import{A as ot,B as S,b as q,f as K,g as Q,j as W,l as X,m as Z,n as tt,q as v,r as T,t as mt,z as V}from"./chunk-ERJNKWX5.js";import{$ as P,Ab as z,Bb as R,D as C,Ib as Y,Ja as c,Na as N,Sa as F,Wa as b,X as g,_a as a,a as D,ac as H,b as A,bc as k,ca as j,da as M,fb as s,gb as r,gc as J,hb as B,la as d,lb as _,ma as l,n as h,nb as u,ob as i,oc as et,qc as nt,r as I,t as x,ta as E,v as y,zb as f}from"./chunk-V72LI5IB.js";var Ot=v("[Comment] Get Comment list"),ct=v("[Comment] Set Comment list",T()),at=v("[Comment] Add Comment (STATE)",T()),wt=v("[Comment] Add Comment (API)",T()),Dt=v("[Comment] Get Comment to edit"),st=v("[Comment] Set Comment to edit",T()),At=v("[Comment] Modify Comment (STATE)",T()),pt=v("[Comment] Delete Comment (STATE)",T());var Ct={comments:[],comment:{commentId:0,parentId:0,creatorId:0,creatorName:"",eventId:0,data:"",creationDate:""}},Ft=ot(Ct,V(ct,(n,{comments:e})=>A(D({},n),{comments:e})),V(at,(n,{comment:e})=>A(D({},n),{comments:[...n.comments,e]})),V(st,(n,{comment:e})=>A(D({},n),{comment:e})),V(pt,(n,{commentId:e})=>A(D({},n),{comments:n.comments.filter(t=>t.commentId!=e)})));var $=class n{constructor(e){this.http=e}getComments(e){return this.http.get(`${S.eventsURL}/${e.id}`).pipe(g(t=>t),C(t=>I(()=>t)))}getComment(e){return this.http.get(`${S.commentsURL}/${e.id}`).pipe(g(t=>t),C(t=>I(()=>t)))}updateComment(e){let t={commentId:e.comment.commentId,creatorId:e.comment.creatorId,parentId:e.comment.parentId,creatorName:e.comment.creatorName,eventId:e.comment.eventId,data:e.text,creationDate:e.comment.creationDate};return this.http.patch(`${S.eventsURL}/${e.comment.eventId}`,t).pipe(C(m=>I(()=>m)))}postComment(e){return console.log(e),this.http.post(`${S.eventsURL}/${e.eventId}`,e).pipe(g(t=>t),C(t=>I(()=>t)))}deleteComment(e){return this.http.delete(`${S.commentsURL}/${e.commentId}`).pipe(C(t=>I(()=>t)))}static{this.\u0275fac=function(t){return new(t||n)(j(J))}}static{this.\u0275prov=P({token:n,factory:n.\u0275fac,providedIn:"root"})}};var dt=class n{constructor(){this.actions$=M(rt);this.commentsService=M($);this.router=M(nt);this.getComments$=O(()=>this.actions$.pipe(w("[Comment] Get Comment list"),y(e=>this.commentsService.getComments(e).pipe(x(t=>({type:"[Comment] Set Comment list",comments:t})),C(()=>h)))),{dispatch:!0});this.getCommentToEdit$=O(()=>this.actions$.pipe(w("[Comment] Get Comment to edit"),y(e=>this.commentsService.getComment(e).pipe(x(t=>({type:"[Comment] Set Comment to edit",comment:t})),C(()=>h)))),{dispatch:!0});this.postComment$=O(()=>this.actions$.pipe(w("[Comment] Add Comment (API)"),y(e=>this.commentsService.postComment(e.payload).pipe(x(t=>({type:"[Comment] Add Comment (STATE)",comment:t})),C(()=>h)))),{dispatch:!0});this.modifyComment$=O(()=>this.actions$.pipe(w("[Comment] Modify Comment (API)"),y(e=>this.commentsService.updateComment(e.payload).pipe(x(t=>({type:"[Comment] Modify Comment (STATE)",comment:e.payload.comment})),g(()=>this.router.navigate(["events",e.payload.comment.eventId])),C(()=>h)))),{dispatch:!0});this.deleteComment$=O(()=>this.actions$.pipe(w("[Comment] Delete Comment (API)"),y(e=>this.commentsService.deleteComment(e.payload).pipe(x(()=>({type:"[Comment] Delete Comment (STATE)",commentId:e.payload.commentId})),g(()=>this.router.navigate(["events",e.payload.eventId])),C(()=>h)))),{dispatch:!0})}static{this.\u0275fac=function(t){return new(t||n)}}static{this.\u0275prov=P({token:n,factory:n.\u0275fac})}};var G=(t=>(t.replying="replying",t.editing="editing",t))(G||{});function ft(n,e){if(n&1){let t=_();s(0,"button",5),u("click",function(){d(t);let o=i();return l(o.handleCancel.emit())}),f(1," \u22C6 Cancel \u22C6 "),r()}}var L=class n{constructor(e){this.fb=e;this.hasCancelButton=!1;this.initialText="";this.handleSubmit=new E;this.handleCancel=new E}ngOnInit(){this.form=this.fb.group({title:[this.initialText]})}onSubmit(){this.handleSubmit.emit(this.form.value.title),this.form.reset()}static{this.\u0275fac=function(t){return new(t||n)(N(tt))}}static{this.\u0275cmp=F({type:n,selectors:[["app-comments-form"]],inputs:{submitLabel:"submitLabel",hasCancelButton:"hasCancelButton",initialText:"initialText"},outputs:{handleSubmit:"handleSubmit",handleCancel:"handleCancel"},standalone:!1,decls:6,vars:4,consts:[[1,"form",3,"ngSubmit","formGroup"],["formControlName","title",1,"comment-form-textarea"],[1,"buttonGroup"],["type","submit",1,"comment-form-button",3,"disabled"],["type","button","class","comment-form-button comment-form-cancel-button",3,"click",4,"ngIf"],["type","button",1,"comment-form-button","comment-form-cancel-button",3,"click"]],template:function(t,m){t&1&&(s(0,"form",0),u("ngSubmit",function(){return m.onSubmit()}),B(1,"textarea",1),s(2,"div",2)(3,"button",3),f(4),r(),b(5,ft,2,0,"button",4),r()()),t&2&&(a("formGroup",m.form),c(3),a("disabled",m.form.invalid),c(),R(" \u{1104D}",m.submitLabel,"\u{1104D} "),c(),a("ngIf",m.hasCancelButton))},dependencies:[W,q,K,Q,k,X,Z],styles:[".comment-form-textarea[_ngcontent-%COMP%]{font-family:charming;font-size:2.5vw;width:60%;height:80px;margin-bottom:1vw;margin-top:1vw;border-color:#3b3b04;box-shadow:0 8px 16px #dbcca3;border-radius:12%;opacity:.7;background-color:#d0cab8}.comment-form-button[_ngcontent-%COMP%]{font-size:16px;padding:8px 16px;background:#d0cab8;border-color:#3b3b04;box-shadow:0 8px 16px #dbcca3;border-radius:8px;color:#000;font-family:cardinal;font-size:2vw;height:5vw;width:13vw}.comment-form-button[_ngcontent-%COMP%]:hover:enabled{cursor:pointer;background:#dbcca3}.comment-form-button[_ngcontent-%COMP%]:disabled{opacity:.7;cursor:default}.comment-form-cancel-button[_ngcontent-%COMP%]{margin-left:10px}.form[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly}.buttonGroup[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr)}"]})}};var Et=()=>[];function gt(n,e){if(n&1&&(s(0,"div",11),f(1),r()),n&2){let t=i();c(),z(t.comment.data)}}function bt(n,e){if(n&1){let t=_();s(0,"app-comments-form",12),u("handleSubmit",function(o){d(t);let p=i();return l(p.updateComment.emit({text:o,comment:p.comment}))})("handleCancel",function(){d(t);let o=i();return l(o.setActiveComment.emit(null))}),r()}if(n&2){let t=i();a("hasCancelButton",!0)("initialText",t.comment.data)}}function Tt(n,e){if(n&1){let t=_();s(0,"div",13),u("click",function(){d(t);let o=i();return l(o.setActiveComment.emit({commentId:o.comment.commentId,type:o.activeCommentType.replying}))}),f(1," Reply "),r()}}function ht(n,e){if(n&1){let t=_();s(0,"div",13),u("click",function(){d(t);let o=i();return l(o.setActiveComment.emit({commentId:o.comment.commentId,type:o.activeCommentType.editing}))}),f(1," Edit "),r()}}function It(n,e){if(n&1){let t=_();s(0,"div",13),u("click",function(){d(t);let o=i();return l(o.deleteComment.emit(o.comment))}),f(1," Delete "),r()}}function xt(n,e){if(n&1){let t=_();s(0,"app-comments-form",14),u("handleSubmit",function(o){d(t);let p=i();return l(p.addComment.emit({text:o,parentId:p.replyId}))}),r()}}function yt(n,e){if(n&1){let t=_();s(0,"app-comments-edit",17),u("setActiveComment",function(o){d(t);let p=i(2);return l(p.setActiveComment.emit(o))})("updateComment",function(o){d(t);let p=i(2);return l(p.updateComment.emit(o))})("deleteComment",function(o){d(t);let p=i(2);return l(p.deleteComment.emit(o))})("addComment",function(o){d(t);let p=i(2);return l(p.addComment.emit(o))}),r()}if(n&2){let t=e.$implicit,m=i(2);a("comment",t)("activeComment",m.activeComment)("parentId",m.comment.commentId)("replies",Y(5,Et))("currentUserId",m.currentUserId)}}function Mt(n,e){if(n&1&&(s(0,"div",15),b(1,yt,1,6,"app-comments-edit",16),r()),n&2){let t=i();c(),a("ngForOf",t.replies)}}var lt=class n{constructor(e,t){this.actRouter=e;this.store=t;this.setActiveComment=new E;this.deleteComment=new E;this.addComment=new E;this.updateComment=new E;this.createdAt="";this.canReply=!1;this.canEdit=!1;this.canDelete=!1;this.activeCommentType=G;this.replyId=null;this.cookieService=M(it);this.commentToEdit=null;this.id=this.actRouter.snapshot.params.id}isReplying(){return this.activeComment?this.activeComment.commentId===this.comment.commentId&&this.activeComment.type===this.activeCommentType.replying:!1}isEditing(){return this.activeComment?this.activeComment.commentId===this.comment.commentId&&this.activeComment.type==="editing":!1}ngOnInit(){let t=new Date().getMilliseconds()-new Date(this.comment.creationDate).getMilliseconds()>3e5;this.createdAt=new Date(this.comment.creationDate).toLocaleDateString(),this.canReply=!!this.currentUserId,this.canEdit=this.currentUserId===this.comment.creatorId&&!t,this.canDelete=this.currentUserId===this.comment.creatorId&&this.replies.length===0&&!t,this.replyId=this.parentId?this.parentId:this.comment.commentId,this.username=this.cookieService.get("username")}static{this.\u0275fac=function(t){return new(t||n)(N(et),N(mt))}}static{this.\u0275cmp=F({type:n,selectors:[["app-comments-edit"]],inputs:{comment:"comment",activeComment:"activeComment",replies:"replies",currentUserId:"currentUserId",parentId:"parentId"},outputs:{setActiveComment:"setActiveComment",deleteComment:"deleteComment",addComment:"addComment",updateComment:"updateComment"},standalone:!1,decls:14,vars:8,consts:[[1,"comment"],[1,"comment-right-part"],[1,"comment-content"],[1,"comment-author"],["class","comment-text",4,"ngIf"],["submitLabel","Update",3,"hasCancelButton","initialText","handleSubmit","handleCancel",4,"ngIf"],[1,"actions-block"],[1,"comment-actions"],["class","comment-action",3,"click",4,"ngIf"],["submitLabel","Reply",3,"handleSubmit",4,"ngIf"],["class","replies",4,"ngIf"],[1,"comment-text"],["submitLabel","Update",3,"handleSubmit","handleCancel","hasCancelButton","initialText"],[1,"comment-action",3,"click"],["submitLabel","Reply",3,"handleSubmit"],[1,"replies"],["class","edit",3,"comment","activeComment","parentId","replies","currentUserId","setActiveComment","updateComment","deleteComment","addComment",4,"ngFor","ngForOf"],[1,"edit",3,"setActiveComment","updateComment","deleteComment","addComment","comment","activeComment","parentId","replies","currentUserId"]],template:function(t,m){t&1&&(s(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),f(4),r()(),b(5,gt,2,1,"div",4)(6,bt,1,2,"app-comments-form",5),s(7,"div",6)(8,"div",7),b(9,Tt,2,0,"div",8)(10,ht,2,0,"div",8)(11,It,2,0,"div",8),r()(),b(12,xt,1,0,"app-comments-form",9)(13,Mt,2,1,"div",10),r()()),t&2&&(c(4),R("\u269C ",m.comment.creatorName?m.comment.creatorName:m.username," \u269C"),c(),a("ngIf",!m.isEditing()),c(),a("ngIf",m.isEditing()),c(3),a("ngIf",m.canReply),c(),a("ngIf",m.canEdit),c(),a("ngIf",m.canDelete),c(),a("ngIf",m.isReplying()),c(),a("ngIf",m.replies.length>0))},dependencies:[H,k,n,L],styles:[".comment[_ngcontent-%COMP%]{display:flex;margin-bottom:28px}.comment-author[_ngcontent-%COMP%]{font-family:cardinal;margin-right:8px;font-size:4vw;color:#000}.comment-text[_ngcontent-%COMP%]{border-color:#3b3b04;box-shadow:0 8px 16px #dbcca3;background-color:#d0cab8;border-style:solid;border-radius:29%;width:50vw;text-align:start;padding:1.5vw;font-family:charming;font-size:2vw;opacity:.7}.comment-actions[_ngcontent-%COMP%]{display:flex;font-size:12px;color:#000;cursor:pointer;margin:0 1vw 1.7vw}.comment-action[_ngcontent-%COMP%]{font-size:2vw;margin:0 1vw 2vw}.comment-action[_ngcontent-%COMP%]:hover{text-decoration:underline}.replies[_ngcontent-%COMP%]{margin-top:20px}.comment-right-part[_ngcontent-%COMP%]{width:100%;margin-left:10vw}"]})}};export{L as a,lt as b,Ft as c,dt as d};
